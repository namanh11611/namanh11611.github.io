<!doctype html><html lang=vi dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Như anh em đã biết, tất cả Dart code chạy trong các isolate, bắt đầu từ main isolate mặc định. Khi phát triển các ứng dụng Flutter, việc xử lý các tác vụ nặng như xử lý ảnh, tính toán phức tạp... trên main isolate này sẽ gây ra hiện tượng giật lag. Và Isolate API sinh ra chính là để giải quyết vấn đề này, nó sẽ giúp chúng ta đưa những tác vụ nặng đó xuống background worker, giúp ứng dụng trở lại với sự mượt mà vốn có."><title>Isolate trong Flutter: Kẻ cứu cánh cho những tác vụ nặng</title><link rel=canonical href=https://namanh11611.github.io/vi/p/isolate/><link rel=stylesheet href=/scss/style.min.833d6eed45de56f48306bf57268d5b8cdfc8a60e8e7bdc99810464fcd033f7c6.css><meta property='og:title' content="Isolate trong Flutter: Kẻ cứu cánh cho những tác vụ nặng"><meta property='og:description' content="Như anh em đã biết, tất cả Dart code chạy trong các isolate, bắt đầu từ main isolate mặc định. Khi phát triển các ứng dụng Flutter, việc xử lý các tác vụ nặng như xử lý ảnh, tính toán phức tạp... trên main isolate này sẽ gây ra hiện tượng giật lag. Và Isolate API sinh ra chính là để giải quyết vấn đề này, nó sẽ giúp chúng ta đưa những tác vụ nặng đó xuống background worker, giúp ứng dụng trở lại với sự mượt mà vốn có."><meta property='og:url' content='https://namanh11611.github.io/vi/p/isolate/'><meta property='og:site_name' content='Henry Techie'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Flutter'><meta property='article:tag' content='Isolate'><meta property='article:published_time' content='2025-05-25T00:00:00+07:00'><meta property='article:modified_time' content='2025-05-25T00:00:00+07:00'><meta property='og:image' content='https://namanh11611.github.io/p/isolate/isolate.webp'><meta name=twitter:title content="Isolate trong Flutter: Kẻ cứu cánh cho những tác vụ nặng"><meta name=twitter:description content="Như anh em đã biết, tất cả Dart code chạy trong các isolate, bắt đầu từ main isolate mặc định. Khi phát triển các ứng dụng Flutter, việc xử lý các tác vụ nặng như xử lý ảnh, tính toán phức tạp... trên main isolate này sẽ gây ra hiện tượng giật lag. Và Isolate API sinh ra chính là để giải quyết vấn đề này, nó sẽ giúp chúng ta đưa những tác vụ nặng đó xuống background worker, giúp ứng dụng trở lại với sự mượt mà vốn có."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://namanh11611.github.io/p/isolate/isolate.webp'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Hiển thị Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/vi/><img src=/img/avatar_hu_99416cdbb1f5ed1b.webp width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/vi>Henry Techie</a></h1><h2 class=site-description>Software Engineer</h2></div></header><ol class=menu-social><li><a href=https://linkedin.com/in/namanh11611 target=_blank title=LinkedIn rel=me><svg class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=https://github.com/namanh11611 target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://viblo.asia/u/namanh11611 target=_blank title=Viblo rel=me><svg class="icon icon-tabler icon-tabler-letter-v" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 4l6 16 6-16"/></svg></a></li><li><a href=https://twitter.com/namanh11611 target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li><li><a href=https://facebook.com/namanh11611 target=_blank title=Facebook rel=me><svg class="icon icon-tabler icon-tabler-brand-facebook" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 10v4h3v7h4v-7h3l1-4h-4V8a1 1 0 011-1h3V3h-3a5 5 0 00-5 5v2H7"/></svg></a></li></ol><ol class=menu id=main-menu><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://namanh11611.github.io/>English</option><option value=https://namanh11611.github.io/vi/ selected>Tiếng Việt</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Chế độ nền tối</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Mục lục</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#isolate-là-gì>Isolate là gì?</a></li><li><a href=#giao-tiếp-giữa-các-isolate>Giao tiếp giữa các Isolate</a></li><li><a href=#sử-dụng-compute-cho-tác-vụ-đơn-giản>Sử dụng <code>compute</code> cho tác vụ đơn giản</a></li><li><a href=#best-practices>Best Practices</a><ol><li><a href=#chỉ-dùng-isolate-cho-các-tác-vụ-tốn-nhiều-cpu>Chỉ dùng isolate cho các tác vụ tốn nhiều CPU</a></li><li><a href=#tránh-tạo-isolate-liên-tục>Tránh tạo isolate liên tục</a></li><li><a href=#sử-dụng-kiểu-dữ-liệu-đơn-giản-khi-truyền-qua-port>Sử dụng kiểu dữ liệu đơn giản khi truyền qua port</a></li><li><a href=#dừng-isolate-khi-không-cần>Dừng isolate khi không cần</a></li></ol></li><li><a href=#kết-luận>Kết Luận</a></li><li><a href=#reference>Reference</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/vi/p/isolate/><img src=/p/isolate/isolate_hu_7c2e7646f6309c5a.webp srcset="/p/isolate/isolate_hu_7c2e7646f6309c5a.webp 800w, /p/isolate/isolate_hu_344d6925f059926b.webp 1600w" width=800 height=447 loading=lazy alt="Featured image of post Isolate trong Flutter: Kẻ cứu cánh cho những tác vụ nặng"></a></div><div class=article-details><header class=article-category><a href=/vi/categories/technical/ style=background-color:#e60f41;color:#fff>Technical
</a><a href=/vi/categories/flutter/ style=background-color:#0d63fe;color:#fff>Flutter</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/vi/p/isolate/>Isolate trong Flutter: Kẻ cứu cánh cho những tác vụ nặng</a></h2><h3 class=article-subtitle>Như anh em đã biết, tất cả Dart code chạy trong các isolate, bắt đầu từ main isolate mặc định. Khi phát triển các ứng dụng Flutter, việc xử lý các tác vụ nặng như xử lý ảnh, tính toán phức tạp... trên main isolate này sẽ gây ra hiện tượng giật lag. Và Isolate API sinh ra chính là để giải quyết vấn đề này, nó sẽ giúp chúng ta đưa những tác vụ nặng đó xuống background worker, giúp ứng dụng trở lại với sự mượt mà vốn có.</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2025-05-25T00:00:00+07:00>thg 5 25, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>6 phút đọc</time></div></footer><footer class=article-translations><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://namanh11611.github.io/p/isolate/ class=link>English</a></div></footer></div></header><section class=article-content><p>Như anh em đã biết, tất cả <strong>Dart</strong> code chạy trong các <strong>isolate</strong>, bắt đầu từ <strong>main isolate</strong> mặc định. Khi phát triển các ứng dụng Flutter, việc xử lý các tác vụ nặng như xử lý ảnh, tính toán phức tạp&mldr; trên <strong>main isolate</strong> này sẽ gây ra hiện tượng <strong>giật lag</strong>. Mặc dù Flutter đã cung cấp cho chúng ta <strong>Future</strong> hay <strong>Stream</strong>, nhưng về bản chất chúng vẫn được xử lý trên <strong>main isolate</strong>. Và <strong>Isolate API</strong> sinh ra chính là để giải quyết vấn đề này, nó sẽ giúp chúng ta đưa những tác vụ nặng đó xuống <strong>background worker</strong>, giúp ứng dụng trở lại với sự mượt mà vốn có. Trong bài viết này, mình sẽ giải thích cách sử dụng <strong>Isolate</strong> và lần lượt cung cấp các best practice trong quá trình sử dụng.</p><h1 id=isolate-là-gì>Isolate là gì?</h1><p><strong>Dart</strong> là ngôn ngữ <strong>single-thread</strong>, khi bạn sử dụng <strong>async</strong>, <strong>await</strong>, thực chất là nó đang chạy <strong>concurrency</strong> (đồng thời). Khi một tác vụ tốn thời gian chạy trên main thread, nó sẽ <strong>block toàn bộ UI</strong>. Và <strong>Isolate</strong> là nhân tố giúp chúng ta giải quyết bài toán <strong>parallelism</strong> (song song).</p><p><strong>Isolate</strong> là một <strong>luồng thực thi độc lập</strong> trong Dart. Mỗi isolate có bộ nhớ <strong>Heap</strong> riêng, đảm bảo rằng không isolate nào có thể truy cập vào bộ nhớ của isolate khác, giúp cho ứng dụng chạy mượt mà mà không có trạng thái chia sẻ.</p><p>Bắt tay ngay vào code cho dễ hình dung, chúng ta sẽ đến với ví dụ đầu tiên là tạo ra một Isolate đơn giản:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=k>import</span> <span class=s1>&#39;dart:isolate&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Isolate</span><span class=p>.</span><span class=n>spawn</span><span class=p>(</span><span class=n>isolateMethod</span><span class=p>,</span> <span class=s2>&#34;Hello World from Main Isolate&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=s1>&#39;Main isolate&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>isolateMethod</span><span class=p>(</span><span class=kt>String</span> <span class=n>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=s1>&#39;New isolate: </span><span class=si>$</span><span class=n>message</span><span class=s1>&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Trong ví dụ trên, hàm <code>main()</code> sẽ chạy trên <strong>main isolate</strong>, thường được gọi là <strong>UI isolate</strong>. Chúng ta tạo một <strong>isolate mới</strong> bằng cách gọi phương thức <code>Isolate.spawn()</code>, nó sẽ thực thi hàm <code>isolateMethod()</code>. Các isolate phụ như này sẽ không truy cập được UI.</p><h1 id=giao-tiếp-giữa-các-isolate>Giao tiếp giữa các Isolate</h1><p>Khi cần trao đổi dữ liệu giữa các isolate, Dart đã cung cấp cho chúng ta 2 class là <code>SendPort</code> và <code>ReceivePort</code> để giúp các Isolate giao tiếp với nhau thông qua message. Các bạn hãy đọc qua đoạn code sau, mình sẽ giải thích chi tiết bên dưới.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=kt>void</span> <span class=n>main</span><span class=p>()</span> <span class=kd>async</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>final</span> <span class=n>mainReceivePort</span> <span class=o>=</span> <span class=n>ReceivePort</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kd>final</span> <span class=n>isolate</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>Isolate</span><span class=p>.</span><span class=n>spawn</span><span class=p>(</span><span class=n>twoWayIsolate</span><span class=p>,</span> <span class=n>mainReceivePort</span><span class=p>.</span><span class=n>sendPort</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Nhận SendPort từ isolate phụ
</span></span></span><span class=line><span class=cl>  <span class=n>mainReceivePort</span><span class=p>.</span><span class=n>listen</span><span class=p>((</span><span class=n>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>message</span> <span class=k>is</span> <span class=n>SendPort</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>print</span><span class=p>(</span><span class=s1>&#39;Main: SendPort&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>message</span><span class=p>.</span><span class=n>send</span><span class=p>(</span><span class=s1>&#39;Hello&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>print</span><span class=p>(</span><span class=s1>&#39;Main received: </span><span class=si>$</span><span class=n>message</span><span class=s1>&#39;</span><span class=p>);</span> <span class=c1>// Output: Hello to Henry
</span></span></span><span class=line><span class=cl>      <span class=n>isolate</span><span class=p>.</span><span class=n>kill</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>twoWayIsolate</span><span class=p>(</span><span class=n>SendPort</span> <span class=n>mainSendPort</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>final</span> <span class=n>receivePort</span> <span class=o>=</span> <span class=n>ReceivePort</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Gửi SendPort của isolate phụ về main
</span></span></span><span class=line><span class=cl>  <span class=n>mainSendPort</span><span class=p>.</span><span class=n>send</span><span class=p>(</span><span class=n>receivePort</span><span class=p>.</span><span class=n>sendPort</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>receivePort</span><span class=p>.</span><span class=n>listen</span><span class=p>((</span><span class=n>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>message</span> <span class=k>is</span> <span class=kt>String</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>print</span><span class=p>(</span><span class=s1>&#39;Worker received: </span><span class=si>$</span><span class=n>message</span><span class=s1>&#39;</span><span class=p>);</span> <span class=c1>// Output: Hello
</span></span></span><span class=line><span class=cl>      <span class=kd>final</span> <span class=n>newMessage</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=si>$</span><span class=n>message</span><span class=s1> to Henry&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>mainSendPort</span><span class=p>.</span><span class=n>send</span><span class=p>(</span><span class=n>newMessage</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Trong ví dụ này, chúng ta sẽ thiết lập giao tiếp 2 chiều giữa main isolate và isolate phụ thông qua đoạn code:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=c1>// Gửi SendPort của isolate phụ về main
</span></span></span><span class=line><span class=cl><span class=n>mainSendPort</span><span class=p>.</span><span class=n>send</span><span class=p>(</span><span class=n>receivePort</span><span class=p>.</span><span class=n>sendPort</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>Ngay sau khi nhận được message là <code>SendPort</code>, main isolate đã gửi lời chào đến isolate phụ:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=n>message</span><span class=p>.</span><span class=n>send</span><span class=p>(</span><span class=s1>&#39;Hello&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>Isolate phụ cũng đã đáp lễ bằng cách gửi lời chào ngược lại đến main isolate:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=kd>final</span> <span class=n>newMessage</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=si>$</span><span class=n>message</span><span class=s1> to Henry&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>mainSendPort</span><span class=p>.</span><span class=n>send</span><span class=p>(</span><span class=n>newMessage</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>Các bạn có thể thấy, <code>SendPort.send()</code> sẽ là thằng chịu trách nhiệm gửi message, còn việc lắng nghe message sẽ được thực hiện qua <code>ReceivePort.listen()</code>.</p><h1 id=sử-dụng-compute-cho-tác-vụ-đơn-giản>Sử dụng <code>compute</code> cho tác vụ đơn giản</h1><p>Flutter cung cấp hàm <code>compute</code> để chạy hàm trong isolate mới với chỉ với 1 dòng code đơn giản như sau:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=n>Future</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;</span> <span class=n>fetchData</span><span class=p>()</span> <span class=kd>async</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>final</span> <span class=n>result</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>compute</span><span class=p>(</span><span class=n>_heavyProcessing</span><span class=p>,</span> <span class=m>1000000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=s1>&#39;Kết quả: </span><span class=si>$</span><span class=n>result</span><span class=s1>&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Hàm này sẽ chạy trong isolate riêng
</span></span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>_heavyProcessing</span><span class=p>(</span><span class=kt>int</span> <span class=n>iterations</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>sum</span> <span class=o>=</span> <span class=m>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=m>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>iterations</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>sum</span> <span class=o>+=</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Ưu điểm của <code>compute</code> là <strong>tự động quản lý</strong> isolate, nó sẽ được <strong>hủy</strong> ngay sau khi hoàn thành.</p><p>Tuy nhiên, có ưu thì cũng phải có nhược, giới hạn của <code>compute</code> là chỉ truyền được <strong>1 tham số</strong>, nếu muốn nhiều tham số hơn thì bạn phải đóng gói nó vào Map hoặc List. Ngoài ra, <code>compute</code> cũng không thể giao tiếp 2 chiều như <code>Isolate.spawn</code> trong ví dụ trên.</p><h1 id=best-practices>Best Practices</h1><h2 id=chỉ-dùng-isolate-cho-các-tác-vụ-tốn-nhiều-cpu>Chỉ dùng isolate cho các tác vụ tốn nhiều CPU</h2><p>Với các network request, chúng ta có thể dùng http client bình thường. Chỉ nên dùng nó trong các trường hợp tốn nhiều CPU như xử lý ảnh.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=c1>// Nên
</span></span></span><span class=line><span class=cl><span class=n>compute</span><span class=p>(</span><span class=n>imageProcessing</span><span class=p>,</span> <span class=n>imageData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Không nên
</span></span></span><span class=line><span class=cl><span class=n>compute</span><span class=p>(</span><span class=n>networkRequest</span><span class=p>,</span> <span class=n>url</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=tránh-tạo-isolate-liên-tục>Tránh tạo isolate liên tục</h2><p>Việc tạo isolate mới liên tục gây tiêu tốn CPU và bộ nhớ, đồng thời việc khởi tạo isolate cũng khá chậm, mất khoảng 30ms mỗi lần. Vậy nên, việc sử dụng <strong>Worker Pool</strong> sẽ giúp tái sử dụng các isolate đã tạo.</p><h2 id=sử-dụng-kiểu-dữ-liệu-đơn-giản-khi-truyền-qua-port>Sử dụng kiểu dữ liệu đơn giản khi truyền qua port</h2><p>Do các isolate không chia sẻ bộ nhớ nên dữ liệu truyền giữa các isolate phải được <strong>serialized</strong>/<strong>deserialized</strong>. Nếu sử dụng kiểu dữ liệu phức tạp sẽ làm tăng thời gian chuyển đổi và tốn bộ nhớ khi copy dữ liệu.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=c1>// Nên
</span></span></span><span class=line><span class=cl><span class=n>sendPort</span><span class=p>.</span><span class=n>send</span><span class=p>({</span><span class=s1>&#39;id&#39;</span><span class=o>:</span> <span class=m>1</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=o>:</span> <span class=m>42</span><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Không nên
</span></span></span><span class=line><span class=cl><span class=n>sendPort</span><span class=p>.</span><span class=n>send</span><span class=p>(</span><span class=n>MyComplexClass</span><span class=p>());</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=dừng-isolate-khi-không-cần>Dừng isolate khi không cần</h2><p>Khi sử dụng <code>Isolate.spawn</code>, nó sẽ không tự động giải phóng khi không dùng nữa. Việc để isolate chạy ngầm sẽ gây tốn CPU/bộ nhớ và có thể là cả memory leak. Vậy nên chúng ta có thể sử dụng hàm <code>Isolate.kill</code> để dừng khi hoàn thành.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=n>isolate</span><span class=p>.</span><span class=n>kill</span><span class=p>(</span><span class=nl>priority:</span> <span class=n>Isolate</span><span class=p>.</span><span class=n>immediate</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=kết-luận>Kết Luận</h1><p>Isolate là công cụ mạnh mẽ để xử lý các tác vụ nặng trong Flutter mà không ảnh hưởng đến UI. Tuy có độ phức tạp nhất định, nhưng khi sử dụng đúng cách bằng việc kết hợp với <code>compute</code> và các thư viện hỗ trợ, bạn có thể tạo ra ứng dụng mượt mà ngay cả khi xử lý nghiệp vụ phức tạp.</p><h1 id=reference>Reference</h1><ul><li><a class=link href=https://dart.dev/language/concurrency target=_blank rel=noopener>Concurrency in Dart</a></li><li><a class=link href=https://dart.dev/language/isolates target=_blank rel=noopener>Isolates</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/vi/tags/flutter/>Flutter</a>
<a href=/vi/tags/isolate/>Isolate</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Bài viết liên quan</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/vi/p/key/><div class=article-image><img src=/p/key/key.ffa9020b042c3c13187b8126c79e9a5f_hu_9e2d18f629802ea3.webp width=250 height=150 loading=lazy alt="Featured image of post Chuyên án điều tra: Giải mã bí ẩn Key trong Flutter" data-key=key data-hash="md5-/6kCCwQsPBMYe4Emx56aXw=="></div><div class=article-details><h2 class=article-title>Chuyên án điều tra: Giải mã bí ẩn Key trong Flutter</h2></div></a></article><article class=has-image><a href=/vi/p/flutter-mvvm-riverpod/><div class=article-image><img src=/p/flutter-mvvm-riverpod/fmr.5a27e8f835d527d3575a9e5c0a21683b_hu_e9c0e969acd73588.webp width=250 height=150 loading=lazy alt="Featured image of post Flutter MVVM Riverpod Starter: Tạo App Siêu Tốc cho Vibe Coder" data-key=flutter-mvvm-riverpod data-hash="md5-Wifo+DXVJ9NXWp5cCiFoOw=="></div><div class=article-details><h2 class=article-title>Flutter MVVM Riverpod Starter: Tạo App Siêu Tốc cho Vibe Coder</h2></div></a></article><article class=has-image><a href=/vi/p/riverpod/><div class=article-image><img src=/p/riverpod/riverpod.75ef8706287c61946de8649a204caf53_hu_d21e99e438811786.webp width=250 height=150 loading=lazy alt="Featured image of post Dùng code generation provider trong Flutter Riverpod cho đời đơn giản hơn" data-key=riverpod data-hash="md5-de+HBih8YZRt6GSaIEyvUw=="></div><div class=article-details><h2 class=article-title>Dùng code generation provider trong Flutter Riverpod cho đời đơn giản hơn</h2></div></a></article><article class=has-image><a href=/vi/p/flutter-hooks/><div class=article-image><img src=/p/flutter-hooks/hooks.479bb29cb3420ab9959e95b8dcc34ce0_hu_4b8cbdc074c34cc9.webp width=250 height=150 loading=lazy alt="Featured image of post Flutter Hooks - viết code ngắn gọn và hiệu quả hơn" data-key=flutter-hooks data-hash="md5-R5uynLNCCrmVnpW43MNM4A=="></div><div class=article-details><h2 class=article-title>Flutter Hooks - viết code ngắn gọn và hiệu quả hơn</h2></div></a></article><article class=has-image><a href=/vi/p/curved-bottom-navigation-bar/><div class=article-image><img src=/p/curved-bottom-navigation-bar/navigation.74d5da399838c1246cd44ec61c9ee625_hu_9d138c7582eb0a34.webp width=250 height=150 loading=lazy alt="Featured image of post Custom Curved Bottom Navigation Bar trong Flutter" data-key=curved-bottom-navigation-bar data-hash="md5-dNXaOZg4wSRs1E7GHJ7mJQ=="></div><div class=article-details><h2 class=article-title>Custom Curved Bottom Navigation Bar trong Flutter</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//henry-techie.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2019 -
2026 Henry Techie</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.33.0>Stack</a></b> thiết kế bởi <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script data-goatcounter=https://henry-techie.goatcounter.com/count async src=//gc.zgo.at/count.js></script></body></html>
<!doctype html><html lang=vi dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Quản lý bộ nhớ là một yếu tố quan trọng trong lập trình, biết cách tối ưu bộ nhớ sẽ giúp ứng dụng của chúng ta hoạt động mượt mà, không bị lag hoặc crash. Trong bài viết này, chúng ta sẽ tìm hiểu về vai trò, chức năng và cách hoạt động của từng loại bộ nhớ."><title>Bộ nhớ Stack và Heap trong Java</title><link rel=canonical href=https://namanh11611.github.io/vi/p/stack-heap/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="Bộ nhớ Stack và Heap trong Java"><meta property='og:description' content="Quản lý bộ nhớ là một yếu tố quan trọng trong lập trình, biết cách tối ưu bộ nhớ sẽ giúp ứng dụng của chúng ta hoạt động mượt mà, không bị lag hoặc crash. Trong bài viết này, chúng ta sẽ tìm hiểu về vai trò, chức năng và cách hoạt động của từng loại bộ nhớ."><meta property='og:url' content='https://namanh11611.github.io/vi/p/stack-heap/'><meta property='og:site_name' content='Henry Techie'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Stack'><meta property='article:tag' content='Heap'><meta property='article:tag' content='Memory'><meta property='article:tag' content='Java'><meta property='article:tag' content='Android'><meta property='article:published_time' content='2024-01-04T00:00:00+07:00'><meta property='article:modified_time' content='2024-01-04T00:00:00+07:00'><meta property='og:image' content='https://namanh11611.github.io/p/stack-heap/stack-heap.webp'><meta name=twitter:title content="Bộ nhớ Stack và Heap trong Java"><meta name=twitter:description content="Quản lý bộ nhớ là một yếu tố quan trọng trong lập trình, biết cách tối ưu bộ nhớ sẽ giúp ứng dụng của chúng ta hoạt động mượt mà, không bị lag hoặc crash. Trong bài viết này, chúng ta sẽ tìm hiểu về vai trò, chức năng và cách hoạt động của từng loại bộ nhớ."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://namanh11611.github.io/p/stack-heap/stack-heap.webp'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Hiển thị Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/vi/><img src=/img/avatar_hu_94a738b6dc80b619.webp width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/vi>Henry Techie</a></h1><h2 class=site-description>Software Engineer</h2></div></header><ol class=menu-social><li><a href=https://linkedin.com/in/namanh11611 target=_blank title=LinkedIn rel=me><svg class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=https://github.com/namanh11611 target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://viblo.asia/u/namanh11611 target=_blank title=Viblo rel=me><svg class="icon icon-tabler icon-tabler-letter-v" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 4l6 16 6-16"/></svg></a></li><li><a href=https://twitter.com/namanh11611 target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li><li><a href=https://facebook.com/namanh11611 target=_blank title=Facebook rel=me><svg class="icon icon-tabler icon-tabler-brand-facebook" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 10v4h3v7h4v-7h3l1-4h-4V8a1 1 0 011-1h3V3h-3a5 5 0 00-5 5v2H7"/></svg></a></li></ol><ol class=menu id=main-menu><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://namanh11611.github.io/>English</option><option value=https://namanh11611.github.io/vi/ selected>Tiếng Việt</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Chế độ nền tối</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Mục lục</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#bộ-nhớ-stack-với-heap-là-cái-chi-chi>Bộ nhớ Stack với Heap là cái chi chi?</a></li><li><a href=#bộ-nhớ-stack>Bộ nhớ Stack</a><ol><li><a href=#cách-hoạt-động>Cách hoạt động</a></li><li><a href=#stackoverflow>StackOverflow</a></li></ol></li><li><a href=#bộ-nhớ-heap>Bộ nhớ Heap</a><ol><li><a href=#cách-hoạt-động-1>Cách hoạt động</a></li><li><a href=#garbage-collection>Garbage Collection</a></li><li><a href=#outofmemory>OutOfMemory</a></li></ol></li><li><a href=#so-sánh>So sánh</a></li><li><a href=#kết-luận>Kết luận</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/vi/p/stack-heap/><img src=/p/stack-heap/stack-heap_hu_50b99df6b8a1fb21.webp srcset="/p/stack-heap/stack-heap_hu_50b99df6b8a1fb21.webp 800w, /p/stack-heap/stack-heap_hu_e31bb47c93af6606.webp 1600w" width=800 height=533 loading=lazy alt="Featured image of post Bộ nhớ Stack và Heap trong Java"></a></div><div class=article-details><header class=article-category><a href=/vi/categories/technical/ style=background-color:#e60f41;color:#fff>Technical
</a><a href=/vi/categories/android/ style=background-color:#048665;color:#fff>Android</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/vi/p/stack-heap/>Bộ nhớ Stack và Heap trong Java</a></h2><h3 class=article-subtitle>Quản lý bộ nhớ là một yếu tố quan trọng trong lập trình, biết cách tối ưu bộ nhớ sẽ giúp ứng dụng của chúng ta hoạt động mượt mà, không bị lag hoặc crash. Trong bài viết này, chúng ta sẽ tìm hiểu về vai trò, chức năng và cách hoạt động của từng loại bộ nhớ.</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>thg 1 04, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>6 phút đọc</time></div></footer><footer class=article-translations><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://namanh11611.github.io/p/stack-heap/ class=link>English</a></div></footer></div></header><section class=article-content><h1 id=bộ-nhớ-stack-với-heap-là-cái-chi-chi>Bộ nhớ Stack với Heap là cái chi chi?</h1><p>Quản lý bộ nhớ là một yếu tố quan trọng trong lập trình, biết cách tối ưu bộ nhớ sẽ giúp ứng dụng của chúng ta hoạt động mượt mà, không bị lag hoặc crash. JVM (Java Virtual Machine) chia bộ nhớ ra thành 2 phần: <strong>Stack</strong> và <strong>Heap</strong> (các bạn đừng nhầm với cấu trúc dữ liệu Stack và Heap nhé). Trong bài viết này, chúng ta sẽ tìm hiểu về vai trò, chức năng và cách hoạt động của từng loại bộ nhớ.</p><h1 id=bộ-nhớ-stack>Bộ nhớ Stack</h1><h2 id=cách-hoạt-động>Cách hoạt động</h2><p><strong>Stack</strong> lưu trữ các biến có kiểu dữ liệu <strong>primitive</strong> (int, float, char, boolean&mldr;), <strong>biến cục bộ</strong> và <strong>thông tin về các method được gọi</strong>. Nó hoạt động theo cơ chế <strong>LIFO</strong> (<strong>L</strong>ast <strong>I</strong>n <strong>F</strong>irst <strong>O</strong>ut). Nghĩa là những method nào được gọi sau sẽ được Stack cấp phát cho một frame, chứa thông tin về tham số, biến cục bộ, và Stack sẽ giải phóng frame đó khi method được return.</p><p>Ví dụ với một đoạn code như sau:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>doSomething</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>doSomething</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>long</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>123456789L</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>doSomethingElse</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>doSomethingElse</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>23</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Trong Stack sẽ lưu các thông tin theo cấu trúc sau:</p><p><img src=/p/stack-heap/stack.webp width=398 height=358 srcset="/p/stack-heap/stack_hu_5813fcaaff45895c.webp 480w, /p/stack-heap/stack_hu_1401e26d47b9321c.webp 1024w" loading=lazy alt=Stack class=gallery-image data-flex-grow=111 data-flex-basis=266px></p><p>Stack được dùng để thực thi một thread, chính vì vậy JVM sẽ tạo một <strong>stack riêng biệt cho mỗi thread</strong>. Mặc định, nếu chúng ta không khai báo kích thước của Stack, JVM sẽ tạo với kích thước tuỳ thuộc vào <strong>hệ điều hành và kiến trúc máy tính</strong> (thông thường là <strong>1MB</strong>). Tuy nhiên, chúng ta có thể dùng flag <code>-Xss</code> để tuỳ chỉnh kích thước của Stack (không vượt quá max size, thường là 1GB).</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>java -Xss1048576 // 1.048.576 byte
</span></span><span class=line><span class=cl>java -Xss1024k // 1.024 KB
</span></span><span class=line><span class=cl>java -Xss1m // 1 MB
</span></span></code></pre></td></tr></table></div></div><h2 id=stackoverflow>StackOverflow</h2><p>Một lỗi kinh điển liên quan đến Stack là <strong>StackOverflow</strong>. Nó xảy ra khi lượng data được lưu vào Stack vượt quá giới hạn của nó.</p><p>Ví dụ khi chúng ta gọi đệ quy nhưng không có điều kiện dừng:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kt>void</span><span class=w> </span><span class=nf>callRecursion</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>callRecursion</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Bạn có thể tưởng tượng các method liên tục được nạp vào Stack, đến một lúc nào đó nó sẽ vượt quá kích thước 1MB nhỏ bé kia. Vì vậy, đoạn code trên sẽ ném ra lỗi <code>java.lang.StackOverflowError</code>.</p><p>Một số cách để tránh StackOverflow error:</p><ul><li>Đảm bảo các hàm đệ quy có điều kiện dừng hoặc không bị gọi quá nhiều lần</li><li>Quản lý các thread cẩn trọng</li><li>Tránh sử dụng biến local có kích thước quá lớn</li><li>Tránh dependencies vòng tròn</li></ul><h1 id=bộ-nhớ-heap>Bộ nhớ Heap</h1><h2 id=cách-hoạt-động-1>Cách hoạt động</h2><p><strong>Heap</strong> lưu trữ các biến có kiểu dữ liệu <strong>Object</strong> hoặc <strong>array</strong>. Nó sử dụng cơ chế <strong>cấp phát và giải phóng bộ nhớ động</strong>. Heap khá linh hoạt, có thể mở rộng hoặc thu hẹp theo nhu cầu trong quá trình thực thi chương trình.</p><p>Ví dụ, khi chúng ta sử dụng từ khoá <code>new</code> để tạo một object <code>Student</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>doSomething</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>long</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>123456789L</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Student</span><span class=w> </span><span class=n>student</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Student</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>doSomethingElse</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>doSomethingElse</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>23</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>str</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Hello World&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Bộ nhớ sẽ tìm một vùng nhớ trống ngẫu nhiên trong Heap để cấp phát và lưu thông tin của object <code>student</code>. Ở bên Stack sẽ có một <strong>biến tham chiếu</strong>, trỏ sang thông tin của object <code>student</code> bên Heap. Còn đối với String, Heap có một cấu trúc dữ liệu đặc biệt là String pool để lưu trữ chúng.</p><p><img src=/p/stack-heap/heap.webp width=825 height=268 srcset="/p/stack-heap/heap_hu_4d97ceefe5f16248.webp 480w, /p/stack-heap/heap_hu_941833d6bc090be6.webp 1024w" loading=lazy alt=Heap class=gallery-image data-flex-grow=307 data-flex-basis=738px></p><p>Heap được tạo ra khi JVM khởi chạy và nó được sử dụng miễn là ứng dụng còn chạy. Khác với Stack, Heap được chia sẻ giữa toàn bộ các thread.</p><p>Mặc định, kích thước khi khởi tạo của Heap là <strong>256MB</strong> và kích thước lớn nhất là <strong>4068MB</strong>. Chúng ta cũng có thể thay đổi thông số này bằng flag <code>-Xms</code> (kích thước khởi tạo) và <code>-Xmx</code> (kích thước lớn nhất).</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>// Initial heap size = 512MB, Maximum heap size = 1024MB
</span></span><span class=line><span class=cl>java -Xms512m -Xmx1024m
</span></span></code></pre></td></tr></table></div></div><h2 id=garbage-collection>Garbage Collection</h2><p>Trong Java, <strong>Garbage Collection</strong> có trách nhiệm thu hồi bộ nhớ từ các biến trong bộ nhớ Heap mà <strong>không còn được tham chiếu</strong> đến nữa. Quá trình này được thực hiện một cách tự động. Trong ví dụ trên, khi chúng ta không còn dùng đến object <code>student</code> nữa, Garbage Collection sẽ tự động thu hồi vùng nhớ đã cấp phát trước đó cho nó.</p><p>Chính nhờ cơ chế này, Heap cho phép cấp phát và giải phóng vùng nhớ với các biến có kích thước lớn và cấu trúc phức tạp ở runtime. Nếu chúng ta tạo ra quá nhiều biến trong Heap nhưng code lởm nên làm cho Garbage Collection không thể thu hồi vùng nhớ hiệu quả sẽ gây ra <strong>memory leak</strong>.</p><blockquote><p><strong>Garbage Collection</strong> hoạt động như một bạn quản lý trong nhà hàng. Khi có khách đến, các bạn nhân viên sẽ mời khách ngồi vào một bàn trống, mang bát đũa, menu ra cho khách (cấp phát bộ nhớ). Bạn quản lý sẽ thường xuyên đi vòng vòng kiểm tra, nếu thấy bàn nào khách đã ăn xong đi về thì sẽ gọi nhân viên ra lau dọn sạch sẽ để sẵn sàng đón khách mới (giải phóng bộ nhớ).</p></blockquote><h2 id=outofmemory>OutOfMemory</h2><p>Khi Heap bị đầy và chúng ta không thể cấp phát bộ nhớ cho object mới, nó sẽ ném ra lỗi <code>java.lang.OutOfMemoryError</code>.</p><p>Giải pháp của chúng ta là phân tích code, dùng các công cụ profiling để phát hiện xem memory leak xảy ra ở đâu, xoá tham chiếu tới object khi không cần dùng đến nó nữa và để cho Garbage Collection làm việc của nó. Một số cách tối ưu bộ nhớ:</p><ul><li>Tránh tạo các object không cần thiết</li><li>Tái sử dụng object nếu có thể</li><li>Chọn cấu trúc dữ liệu phù hợp</li><li>Ưu tiên sử dụng biến cục bộ thay vì biến toàn cục</li></ul><h1 id=so-sánh>So sánh</h1><div class=table-wrapper><table><thead><tr><th></th><th>Bộ nhớ Stack</th><th>Bộ nhớ Heap</th></tr></thead><tbody><tr><td>Lưu trữ</td><td>primitive, biến cục bộ, method</td><td>Object, array</td></tr><tr><td>Tốc độ truy cập</td><td>Nhanh</td><td>Chậm</td></tr><tr><td>Kích thước</td><td>Nhỏ, Cố định</td><td>Lớn, Linh động</td></tr><tr><td>Phạm vi sử dụng</td><td>Thread tương ứng với Stack</td><td>Toàn bộ các thread</td></tr><tr><td>Thứ tự cấp phát</td><td>LIFO</td><td>Ngẫu nhiên</td></tr><tr><td>Thời gian tồn tại của biến</td><td>Từ lúc call method đến lúc return</td><td>Từ lúc tạo đến lúc bị Garbage Collection giải phóng</td></tr></tbody></table></div><h1 id=kết-luận>Kết luận</h1><p>Trong bài viết này, còn nhiều khái niệm liên quan đến bộ nhớ nhưng mình chưa thể truyền tải hết. Hy vọng bạn đã hiểu một cách căn bản về cách bộ nhớ Stack và Heap hoạt động, từ đó có thêm kinh nghiệm tối ưu hiệu năng của ứng dụng.</p></section><footer class=article-footer><section class=article-tags><a href=/vi/tags/stack/>Stack</a>
<a href=/vi/tags/heap/>Heap</a>
<a href=/vi/tags/memory/>Memory</a>
<a href=/vi/tags/java/>Java</a>
<a href=/vi/tags/android/>Android</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Bài viết liên quan</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/vi/p/memory-leak/><div class=article-image><img src=/p/memory-leak/memory_leak.6943e39c7b0fae6d6026352e261b8ead_hu_5f232c3c5a31d610.webp width=250 height=150 loading=lazy alt="Featured image of post Bác sỹ IT bắt bệnh những trường hợp gây Memory Leak trong Android" data-key=memory-leak data-hash="md5-aUPjnHsPrm1gJjUuJhuOrQ=="></div><div class=article-details><h2 class=article-title>Bác sỹ IT bắt bệnh những trường hợp gây Memory Leak trong Android</h2></div></a></article><article class=has-image><a href=/vi/p/looper-message-queue-handler/><div class=article-image><img src=/p/looper-message-queue-handler/looper_message_queue_handler.389584b807ebe3ac4a61a20690b97265_hu_49bc474237deead4.webp width=250 height=150 loading=lazy alt="Featured image of post Tất tần tật về Looper, MessageQueue và Handler trong Android" data-key=looper-message-queue-handler data-hash="md5-OJWEuAfr46xKYaIGkLlyZQ=="></div><div class=article-details><h2 class=article-title>Tất tần tật về Looper, MessageQueue và Handler trong Android</h2></div></a></article><article class=has-image><a href=/vi/p/kotlin-flow-cheat-sheet-3/><div class=article-image><img src=/p/kotlin-flow-cheat-sheet-3/cheat_sheet.693580b63998c07c78483b5a2f6bbda9_hu_390799656209e09c.webp width=250 height=150 loading=lazy alt="Featured image of post Kotlin Flow cheat sheet phần 3: SharedFlow và StateFlow" data-key=kotlin-flow-cheat-sheet-3 data-hash="md5-aTWAtjmYwHx4SDtaL2u9qQ=="></div><div class=article-details><h2 class=article-title>Kotlin Flow cheat sheet phần 3: SharedFlow và StateFlow</h2></div></a></article><article class=has-image><a href=/vi/p/kotlin-flow-cheat-sheet-2/><div class=article-image><img src=/p/kotlin-flow-cheat-sheet-2/cheat_sheet.693580b63998c07c78483b5a2f6bbda9_hu_390799656209e09c.webp width=250 height=150 loading=lazy alt="Featured image of post Kotlin Flow cheat sheet phần 2: Flow" data-key=kotlin-flow-cheat-sheet-2 data-hash="md5-aTWAtjmYwHx4SDtaL2u9qQ=="></div><div class=article-details><h2 class=article-title>Kotlin Flow cheat sheet phần 2: Flow</h2></div></a></article><article class=has-image><a href=/vi/p/kotlin-flow-cheat-sheet-1/><div class=article-image><img src=/p/kotlin-flow-cheat-sheet-1/cheat_sheet.693580b63998c07c78483b5a2f6bbda9_hu_390799656209e09c.webp width=250 height=150 loading=lazy alt="Featured image of post Kotlin Flow cheat sheet phần 1: Channel" data-key=kotlin-flow-cheat-sheet-1 data-hash="md5-aTWAtjmYwHx4SDtaL2u9qQ=="></div><div class=article-details><h2 class=article-title>Kotlin Flow cheat sheet phần 1: Channel</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//henry-techie.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2019 -
2025 Henry Techie</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> thiết kế bởi <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script data-goatcounter=https://henry-techie.goatcounter.com/count async src=//gc.zgo.at/count.js></script></body></html>